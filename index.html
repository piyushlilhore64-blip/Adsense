<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIMBOT FX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Space+Mono:wght@400;700&display=swap');
        
        :root {
            --neon-blue: #00FFFF;
            --neon-pink: #FF00FF;
            --dark-bg: #1A1A2E;
            --console-green: #00FF00;
        }

        body {
            background-color: #0A0A15; /* Even darker background */
            font-family: 'Orbitron', sans-serif;
            color: #E0E0E0;
        }

        /* App Title Glow */
        .neon-glow {
            text-shadow: 0 0 5px var(--neon-blue), 0 0 10px var(--neon-blue), 0 0 20px rgba(0, 255, 255, 0.5);
            color: #FFFFFF;
        }

        /* Generate Key Button Style */
        .btn-neon {
            background-color: var(--neon-pink);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px var(--neon-pink);
            opacity: 0.5; /* Default dim state */
            cursor: not-allowed;
        }
        .btn-neon.active {
            opacity: 1;
            cursor: pointer;
        }
        .btn-neon.active:hover {
            background-color: var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue), 0 0 30px var(--neon-blue);
        }

        /* Server List Item (New Style - Now individual boxes) */
        .server-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-radius: 8px;
            /* Border and background applied to each item */
            border: 2px solid rgba(255, 0, 255, 0.4); 
            background-color: rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(255, 0, 255, 0.3);
        }
        .server-item:hover {
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue);
        }
        .server-item.selected {
            border-color: var(--neon-blue);
            background-color: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
        }
        
        /* Custom Radio Button Indicator */
        .radio-indicator {
            width: 16px;
            height: 16px;
            border: 2px solid var(--neon-pink);
            border-radius: 50%;
            margin-right: 12px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .server-item.selected .radio-indicator {
            border-color: var(--neon-blue);
            background-color: var(--neon-blue);
            box-shadow: 0 0 5px var(--neon-blue);
        }

        /* Console Box (Terminal Output) */
        .console-box {
            border: 1px solid;
            border-image-slice: 1;
            /* Gradient to match the look */
            border-image-source: linear-gradient(to right, #00FFFF, #FF00FF);
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.4), 0 0 12px rgba(255, 0, 255, 0.4);
            background-color: rgba(0, 0, 10, 0.8);
        }

        /* Large Blank Placeholder Box - Increased Size to 280px */
        .blank-placeholder-box {
            min-height: 280px; /* Increased height */
            border: 2px dashed #00FFFF; /* Neon blue dashed border */
            background-color: rgba(0, 255, 255, 0.05); /* Very slight blue background */
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #007777; /* Dim teal color */
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            text-align: center;
        }


        /* Terminal Text */
        .terminal-text {
            color: var(--neon-blue); 
            text-shadow: 0 0 2px var(--neon-blue);
            font-family: 'Space Mono', monospace;
            white-space: pre-wrap;
            line-height: 1.5;
        }

        /* Protocol Section Header */
        .protocol-header {
            color: var(--neon-blue);
            text-shadow: 0 0 5px var(--neon-blue);
            border-bottom: 2px solid var(--neon-blue);
            padding-bottom: 4px;
        }

        /* Protocol Step Circle */
        .protocol-step {
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 8px var(--neon-blue);
            width: 30px;
            height: 30px;
        }
        .protocol-number {
             color: var(--neon-blue);
             text-shadow: 0 0 3px var(--neon-blue);
             font-weight: 700;
        }
        .protocol-text-header {
            color: #FFFFFF;
            font-weight: 700;
        }
        /* Footer Styling */
        .footer-text {
            color: #777;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="fixed top-2 right-2 z-50">
        <a href="admin.html" class="bg-gray-700 hover:bg-gray-600 text-xs py-1 px-3 rounded-full transition duration-300">
            Go to Admin Panel
        </a>
    </div>

    <div id="main-app" class="w-full max-w-sm p-6 rounded-lg space-y-6">
        
        <header class="text-center">
            <!-- Logo placeholder -->
            <div class="w-16 h-16 mx-auto rounded-full mb-3 border-2 border-transparent" style="box-shadow: 0 0 15px var(--neon-blue), inset 0 0 15px var(--neon-blue);"></div>
            
            <h1 id="app-title" class="text-3xl font-bold neon-glow mb-6">Loading App...</h1>
        </header>
        
        <!-- Large Blank Box Placeholder (Increased Size) -->
        <div class="blank-placeholder-box p-4 rounded-md">
            [DYNAMIC AD/CONTENT SLOT - LARGE SIZE]
        </div>
        <!-- END NEW BLANK BOX -->

        <!-- Server Selection Slot (Modified for individual box display) -->
        <div id="server-selection-slot" class="space-y-3">
             <p class="text-center text-sm font-bold text-cyan-400 uppercase tracking-widest mb-4">Select Server</p>
             <div id="server-buttons-container" class="space-y-2">
                <!-- Server list items will be injected here -->
                <p id="loading-servers" class="col-span-3 text-center text-xs text-gray-500">Loading servers from Firebase...</p>
             </div>
        </div>
        <!-- END SERVER SELECTION SLOT -->
        
        <!-- 1. Console Box -->
        <div class="console-box p-4 rounded-lg">
            <pre id="console-text" class="terminal-text text-sm">
> Initializing Neon Interface...
> Awaiting System Authentication...
> Status: Connecting to Firebase...
            </pre>
        </div>

        <!-- 2. Generate Key Button (Now requires server selection) -->
        <button id="generate-key-btn" onclick="window.generateKey()" class="w-full btn-neon text-gray-900 font-bold py-3 rounded-md uppercase tracking-widest text-lg focus:outline-none focus:ring-4 focus:ring-opacity-50 focus:ring-blue-500">
            Generate Access Key
        </button>
        
        <div id="message-box" class="p-3 mt-4 text-center rounded-md hidden"></div>

        <!-- 3. Access Protocol Section -->
        <section class="mt-8 space-y-4">
            <h2 class="text-xl protocol-header text-left uppercase tracking-widest">Access Protocol</h2>
            
            <div class="space-y-4">
                <!-- Step 1 (Updated) -->
                <div class="flex items-start space-x-3">
                    <div class="protocol-step flex-shrink-0 flex items-center justify-center rounded-full bg-transparent">
                        <span class="protocol-number text-sm">01</span>
                    </div>
                    <div>
                        <p class="protocol-text-header text-sm">Initiate Server Selection</p>
                        <p class="text-xs text-gray-400">Choose an available server to prepare your unique session ID.</p>
                    </div>
                </div>

                <!-- Step 2 (Updated) -->
                <div class="flex items-start space-x-3">
                    <div class="protocol-step flex-shrink-0 flex items-center justify-center rounded-full bg-transparent">
                        <span class="protocol-number text-sm">02</span>
                    </div>
                    <div>
                        <p class="protocol-text-header text-sm">Execute Generation</p>
                        <p class="text-xs text-gray-400">Click 'Generate Access Key' to execute the redirect protocol.</p>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="flex items-start space-x-3">
                    <div class="protocol-step flex-shrink-0 flex items-center justify-center rounded-full bg-transparent">
                        <span class="protocol-number text-sm">03</span>
                    </div>
                    <div>
                        <p class="protocol-text-header text-sm">Authenticate</p>
                        <p class="text-xs text-gray-400">Complete the external steps and return to this protocol.</p>
                    </div>
                </div>
                
                 <!-- Step 4 -->
                <div class="flex items-start space-x-3">
                    <div class="protocol-step flex-shrink-0 flex items-center justify-center rounded-full bg-transparent">
                        <span class="protocol-number text-sm">04</span>
                    </div>
                    <div>
                        <p class="protocol-text-header text-sm">Deploy</p>
                        <p class="text-xs text-gray-400">The system will verify and deploy your exclusive code here.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Footer with Developer Info and WhatsApp Link -->
        <footer class="pt-6 mt-6 border-t border-gray-700/50 text-center space-y-2">
            <p class="footer-text">Developed by SAKIR</p>
            <a href="https://wa.me/917234884468" target="_blank" class="inline-block transition duration-300 hover:scale-110">
                <!-- WhatsApp SVG Icon (Neon Green/Teal) -->
                <svg viewBox="0 0 24 24" class="w-6 h-6" style="fill: var(--console-green); filter: drop-shadow(0 0 3px var(--console-green));">
                    <path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.35 4.97l-1.42 5.17 5.29-1.39c1.47.8 3.12 1.25 4.79 1.25 5.46 0 9.91-4.45 9.91-9.91-.01-5.45-4.46-9.9-9.91-9.9zm4.79 13.9c-.27.28-.59.43-.92.65-.6.41-1.49 1.15-2.22 1.15-.22 0-.37-.08-.53-.19-.18-.12-.4-.36-.59-.72s-.36-.78-.5-1.18c-.44-1.29-.87-2.6-.87-3.92 0-1.12.3-2.19.86-2.92.51-.7 1.21-1.18 1.95-1.18.24 0 .47.05.67.14.28.12.59.34.79.7.2.36.26.79.24 1.14-.03.55-.26 1.05-.51 1.45-.19.3-.59.71-.91 1.03-.31.3-.6.61-.41 1.06.14.37.52.88.94 1.23.41.35.81.56 1.1.72.33.19.66.36.98.47.51.18 1.03.26 1.54.26 1.13 0 2.21-.55 2.87-1.15.22-.2.33-.42.41-.65.08-.24.08-.42.06-.59-.01-.19-.07-.29-.14-.38s-.16-.14-.24-.18c-.08-.03-.17-.05-.27-.05-.13 0-.25.02-.37.07-.12.05-.24.11-.34.2-.14.13-.24.29-.32.49s-.14.4-.14.65c0 .08.01.16.03.22s.07.13.13.18c.07.06.14.1.23.14s.19.06.3.06c.3 0 .58-.1.84-.29.56-.4 1.07-.98 1.48-1.74.41-.77.62-1.63.62-2.58 0-1.07-.26-2.07-.75-2.88-.49-.81-1.18-1.22-1.89-1.22-.39 0-.74.1-.98.29-.24.19-.4.49-.49.9s-.18 1.02-.12 1.52.33.95.59 1.28c.19.24.38.45.56.65.17.2.32.38.46.56.1.13.18.27.24.41s.08.31.08.48c0 .35-.1.69-.29 1.01-.2.33-.49.61-.84.84-.37.24-.76.36-1.19.36-.26 0-.53-.04-.8-.12z"/>
                </svg>
            </a>
        </footer>
        
        <!-- User ID and Debug Status moved to bottom, hidden from main view but useful for troubleshooting -->
        <div class="pt-4 border-t border-gray-700/50 text-xs space-y-2 text-center">
            <p class="text-gray-500">Debug ID: <span id="user-id-display" class="font-mono text-gray-400 break-all">Authenticating...</span></p>
            <p class="text-gray-500">Redirect Count: <span id="redirect-count" class="font-mono text-gray-400">0 URLs Configured</span></p>
        </div>
    </div>

    <script type="module">
        // --- User's Provided Firebase Config ---
        const FIREBASE_CONFIG = {
          apiKey: "AIzaSyCRPYDMzWMfqgxl-755rRxHY22wUcgU8aM",
          authDomain: "abhi-mods-5a2d9.firebaseapp.com",
          projectId: "abhi-mods-5a2d9",
          storageBucket: "abhi-mods-5a2d9.firebasestorage.app",
          messagingSenderId: "811737382169",
          appId: "1:811737382169:web:37e5d6d6d633990bd2d988",
          measurementId: "G-H7QXSWXYNT"
        };
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : FIREBASE_CONFIG;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- Core Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Global Instances and State ---
        let db = null;
        let auth = null;
        let userId = null;
        let isAuthReady = false;
        let redirectUrls = []; // Array of {id: string, url: string}
        let appSettings = {};
        let selectedUrl = null; // New state variable to hold the selected server URL
        
        const COLLECTIONS = {
            SETTINGS: 'appSettings',
            REDIRECTS: 'redirectUrls'
        };

        // --- DOM Elements ---
        const appTitleElement = document.getElementById('app-title');
        const userIdDisplay = document.getElementById('user-id-display');
        const redirectCountDisplay = document.getElementById('redirect-count');
        const messageBox = document.getElementById('message-box');
        const consoleTextElement = document.getElementById('console-text');
        const serverButtonsContainer = document.getElementById('server-buttons-container');
        const generateKeyBtn = document.getElementById('generate-key-btn');
        
        // --- Utility Functions ---

        const showStatusMessage = (message, type = 'info') => {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-red-900/50', 'bg-green-900/50', 'bg-yellow-900/50', 'text-red-300', 'text-green-300', 'text-yellow-300');
            
            if (type === 'error') {
                messageBox.classList.add('bg-red-900/50', 'text-red-300');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-900/50', 'text-green-300');
            } else {
                messageBox.classList.add('bg-yellow-900/50', 'text-yellow-300');
            }

            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 5000);
        };
        
        // --- Simple, direct console status messages ---
        const updateConsoleStatus = (serverSelected = false) => {
            if (!isAuthReady) return;
            
            let statusMessage;
            if (redirectUrls.length > 0) {
                if (serverSelected) {
                    const selectedIndex = redirectUrls.findIndex(r => r.url === selectedUrl);
                    const serverNumber = selectedIndex !== -1 ? selectedIndex + 1 : 'N/A';
                    
                    statusMessage = `
> SERVER ${serverNumber} SELECTED!
> Ready to GENERATE ACCESS KEY.
> Status: ONLINE.
                    `;
                } else {
                    statusMessage = `
> System ONLINE. (${redirectUrls.length} Servers Available).
> SELECT ONE SERVER TO CONTINUE.
> Status: PENDING SELECTION.
                    `;
                }
            } else {
                statusMessage = `
> System Standby.
> No Servers Configured.
> Waiting for admin.
            `;
            }
            // Use replace for basic text styling within the pre tag (keeping neon theme)
            consoleTextElement.innerHTML = statusMessage
                .replace(/ONLINE/g, '<span class="text-green-400">ONLINE</span>')
                .replace(/SELECTED/g, '<span class="text-green-400">SELECTED</span>')
                .replace(/Status: Connecting to Firebase.../g, 'Status: AUTHENTICATED.');
        };
        // -----------------------------------------------------------------

        const renderServerButtons = () => {
            serverButtonsContainer.innerHTML = '';
            
            if (redirectUrls.length === 0) {
                serverButtonsContainer.innerHTML = '<p class="col-span-3 text-center text-xs text-red-400/70">No servers configured by Admin. Protocol Halted.</p>';
                generateKeyBtn.classList.remove('active');
                generateKeyBtn.disabled = true;
                return;
            }

            redirectUrls.forEach((server, index) => {
                const isSelected = server.url === selectedUrl;
                
                const listItem = document.createElement('div');
                // Use the new CSS class for list item styling (now a distinct box)
                let classes = 'server-item';
                if (isSelected) {
                    classes += ' selected';
                }
                
                listItem.className = classes;
                listItem.setAttribute('role', 'radio');
                listItem.setAttribute('aria-checked', isSelected ? 'true' : 'false');
                listItem.onclick = () => window.selectServer(server.url);
                
                // Radio Indicator
                const radioIndicator = document.createElement('div');
                radioIndicator.className = 'radio-indicator';

                // Server Label (Only show the Server Number)
                const serverLabel = document.createElement('p');
                serverLabel.className = 'text-base font-semibold';
                serverLabel.textContent = `SERVER ${index + 1}`;
                
                // NO URL hint is included as requested

                listItem.appendChild(radioIndicator);
                listItem.appendChild(serverLabel);
                serverButtonsContainer.appendChild(listItem);
            });
        };


        // --- Firebase Setup ---
        const setupFirebase = async () => {
            setLogLevel('Debug');
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                generateKeyBtn.disabled = true; // Disable until a server is selected

                // Sign in anonymously if no custom token is provided
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        userIdDisplay.textContent = userId;
                        isAuthReady = true;
                        startListeners();
                    } else {
                        userIdDisplay.textContent = 'Failed to authenticate.';
                        updateConsoleStatus(); 
                    }
                });

            } catch (error) {
                console.error("Firebase initialization or sign-in failed:", error);
                showStatusMessage("Initialization failed. Check console for details.", 'error');
                updateConsoleStatus();
            }
        };

        const startListeners = () => {
            if (!db) return;

            // 1. App Settings Listener (Public Data)
            const settingsRef = doc(db, 'artifacts', appId, 'public', 'data', COLLECTIONS.SETTINGS, 'config');
            onSnapshot(settingsRef, (docSnap) => {
                const data = docSnap.data();
                if (data) {
                    appSettings = data;
                    appTitleElement.textContent = data.title || 'SAKIR AIMBOT';
                } else {
                    appSettings = { title: 'SAKIR AIMBOT' };
                    appTitleElement.textContent = appSettings.title;
                }
            }, (error) => console.error("Error listening to settings:", error));

            // 2. Redirect URLs Listener (Public Data)
            const redirectCollectionRef = collection(db, 'artifacts', appId, 'public', 'data', COLLECTIONS.REDIRECTS);
            onSnapshot(redirectCollectionRef, (snapshot) => {
                redirectUrls = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.url) {
                        // Ensure the URL is valid before adding
                        try {
                            new URL(data.url);
                            redirectUrls.push({ id: doc.id, url: data.url });
                        } catch (e) {
                            console.error("Invalid URL found in database:", data.url);
                        }
                    }
                });
                redirectCountDisplay.textContent = `${redirectUrls.length} URLs Configured`;
                
                // If the previously selected URL is no longer valid, deselect it
                if (selectedUrl && !redirectUrls.some(r => r.url === selectedUrl)) {
                    selectedUrl = null;
                }
                
                renderServerButtons(); // Rerender buttons when data changes
                updateConsoleStatus(!!selectedUrl); // Update console based on selection state
                
                // Update button state based on selection
                if (selectedUrl) {
                    generateKeyBtn.classList.add('active');
                    generateKeyBtn.disabled = false;
                } else {
                    generateKeyBtn.classList.remove('active');
                    generateKeyBtn.disabled = true;
                }
                
            }, (error) => console.error("Error listening to redirect URLs:", error));
            
            // Set initial console status
            updateConsoleStatus(!!selectedUrl);
        };

        document.addEventListener('DOMContentLoaded', setupFirebase);
        
        // --- Core Application Logic ---
        
        window.selectServer = (url) => {
            if (!isAuthReady) {
                showStatusMessage("System is authenticating. Please wait.", 'error');
                return;
            }
            
            // Set the new selected URL
            selectedUrl = url;
            
            // Re-render the button list to update selection state
            renderServerButtons();
            
            generateKeyBtn.classList.add('active');
            generateKeyBtn.disabled = false;
            
            updateConsoleStatus(true);
            showStatusMessage(`SERVER SELECTED: Ready to generate key.`, 'success');
        };

        window.generateKey = () => {
            if (!isAuthReady) {
                showStatusMessage("System is authenticating. Please wait.", 'error');
                return;
            }

            if (!selectedUrl) {
                 showStatusMessage("ERROR: Please select a server first.", 'error');
                 return;
            }

            // 1. Construct the final URL with the user ID as a query parameter
            const targetUrl = selectedUrl;
            // The functionality: The selected server's URL is opened.
            const finalUrl = `${targetUrl}${targetUrl.includes('?') ? '&' : '?'}uid=${userId}`;

            showStatusMessage(`INITIATING PROTOCOL: Redirecting now...`, 'info');
            
            // 2. Redirect the user
            setTimeout(() => {
                window.location.href = finalUrl;
            }, 1000); 
        };

    </script>
</body>
</html>